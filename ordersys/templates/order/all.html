{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}管理订单{% endblock %}</h1>
<a class="action" href="{{ url_for('auth.index') }}">首页</a>
{% endblock %}

{% block content %}
<script src="{{ url_for('static', filename='jquery.js') }}"></script>
<script>
  $(document).ready(function() {
    var filter = $('#orderfilter');

    filter.change(function () {
      var val = $('#orderfilter option:selected').attr('value');
      var url = window.location.href.split('?')[0];
      window.location.href = url + '?filter=' + val;
    });

    var key = 'filter=';
    var value = 'all'

    if (window.location.href.indexOf('?') !== -1) {
      var qs = window.location.href.split('?')[1].split('&');

      for (var i in qs) {
        var index = qs[i].indexOf(key);
        if (index !== -1) {
          // found!
          value = qs[i].substring(index + key.length);
        }
      }
    }

    filter.val(value);
  });
</script>

<article class="item">
  <select class="orderfilter" id="orderfilter">
    <option id="confirmed" value="confirmed">已选择配送方式的订单</option>
    <option id="new" value="new">未选择配送方式的订单</option>
    <option id="cancelled" value="cancelled">已取消订单</option>
    <option id="finished" value="finished">已完成订单</option>
    <option id="all" value="all">所有订单</option>
  </select>
</article>

{% for order in orders%}
<article class="item">
  <div class="iteminfo">
    <span class="itemtime">{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
    <span>{{order.price}}元</span>
    <a href="{{ url_for('order.eito', id=order['id']) }}">详细</a>
  </div>
  <!--
       <div class="itemaction">
       {% if order['status'] == 'new' %}
       <a href="{{ url_for('order.eito', id=order['id'] ) }}">选择配送方式</a>
       &nbsp;
       {% endif %}
       <a href="{{ url_for('order.view', id=order['id'] ) }}">查看</a>
       </div>
  -->
</article>
{% endfor%}
{% endblock %}
